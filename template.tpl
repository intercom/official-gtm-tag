___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Intercom",
  "categories": [
    "CHAT",
    "EMAIL_MARKETING",
    "LEAD_GENERATION",
    "MARKETING",
    "PERSONALIZATION",
    "SALES"
  ],
  "brand": {
    "id": "brand_intercom",
    "displayName": "Intercom",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Install and get the most out of Intercom\u0027s Messenger on your website.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "method_group",
    "displayName": "Method",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SELECT",
        "name": "method",
        "displayName": "",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "install",
            "displayValue": "Install"
          },
          {
            "value": "boot",
            "displayValue": "Boot"
          },
          {
            "value": "shutdown",
            "displayValue": "Shutdown"
          },
          {
            "value": "update",
            "displayValue": "Update"
          },
          {
            "value": "hide",
            "displayValue": "Hide"
          },
          {
            "value": "show",
            "displayValue": "Show"
          },
          {
            "value": "showMessages",
            "displayValue": "Show Messages"
          },
          {
            "value": "showNewMessage",
            "displayValue": "Show New Message"
          },
          {
            "value": "onHide",
            "displayValue": "On Hide"
          },
          {
            "value": "onShow",
            "displayValue": "On Show"
          },
          {
            "value": "onUnreadCountChange",
            "displayValue": "On Unread Count Change"
          },
          {
            "value": "trackEvent",
            "displayValue": "Track Event"
          },
          {
            "value": "startTour",
            "displayValue": "Start Tour"
          },
          {
            "value": "showSpace",
            "displayValue": "Show Space"
          }
        ],
        "simpleValueType": true,
        "alwaysInSummary": true,
        "help": "",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "defaultValue": "install"
      },
      {
        "type": "LABEL",
        "name": "install_label",
        "displayName": "Install Intercom on the current page.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "install",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "boot_label",
        "displayName": "If you\u0027d like to control when Intercom is loaded, you can use the \u0027boot\u0027 method. \nThis is useful in situations like a one-page JavaScript based application where the user may not be logged in when the page loads.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "boot",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "shutdown_label",
        "displayName": "If you have the Inbox product (combined with another product like Messages) you should call the Intercom shutdown method to clear your users’ conversations anytime they logout of your application. Otherwise, the cookie we use to track who was most recently logged in on a given device or computer will keep these conversations in the Messenger for one week. This method will effectively clear out any user data that you have been passing through the tag.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "shutdown",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "update_label",
        "displayName": "Calling the update method with some new user data will trigger Intercom to look for new messages that should be displayed to the current user and show them if they exist.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "update",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "hide_label",
        "displayName": "This will hide the main Messenger panel if it is open. It will not hide the Messenger Launcher.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "hide",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "show_label",
        "displayName": "This will show the Messenger. If there are no new conversations, it will open to the Messenger Home. If there are, it will open with the message list.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "show",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "showMessages_label",
        "displayName": "This will open the Messenger with the message list.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "showMessages",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "showNewMessage_label",
        "displayName": "This will open the Messenger as if a new conversation was just created.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "showNewMessage",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "onShow_label",
        "displayName": "When we show the messenger, you can trigger a custom event.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "onShow",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "onHide_label",
        "displayName": "When we hide the messenger, you can trigger a custom event.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "onHide",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "onUnreadCountChange_label",
        "displayName": "This method allows you to register a custom event that will be triggered immediately when invoked, and again whenever the current number of unread messages changes.\nThe new “unread count” will be available as a dataLayer variable named “intercom_unread_count”.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "onUnreadCountChange",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "trackEvent_label",
        "displayName": "You can submit an event using the trackEvent method. This will associate the event with the currently logged in user and send it to Intercom.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "trackEvent",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "startTour_label",
        "displayName": "If you would like to trigger a tour based on an action a user or visitor takes in your site or application, you can use this method.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "startTour",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "showSpace_label",
        "displayName": "If you would like to open particular Messenger space.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "showSpace",
            "type": "EQUALS"
          }
        ]
      }
    ],
    "help": "Either simply install the Messenger or perform other methods as documented in https://developers.intercom.com/installing-intercom/docs/intercom-javascript"
  },
  {
    "type": "GROUP",
    "name": "method_arguments",
    "displayName": "Method Arguments",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "GROUP",
        "name": "install_boot_update_arguments",
        "displayName": "",
        "groupStyle": "NO_ZIPPY",
        "subParams": [
          {
            "type": "TEXT",
            "name": "app_id",
            "displayName": "Workspace ID",
            "simpleValueType": true,
            "alwaysInSummary": false,
            "notSetText": "Workspace ID is required for Messenger installation",
            "help": "Your App ID is available in Intercom in Settings -\u003e Installation -\u003e Web",
            "enablingConditions": [
              {
                "paramName": "method",
                "paramValue": "install",
                "type": "EQUALS"
              },
              {
                "paramName": "method",
                "paramValue": "update",
                "type": "EQUALS"
              },
              {
                "paramName": "method",
                "paramValue": "boot",
                "type": "EQUALS"
              }
            ]
          },
          {
            "type": "CHECKBOX",
            "name": "log_impression",
            "checkboxText": "Log impression at the current URL",
            "simpleValueType": true,
            "displayName": "Log Impression",
            "enablingConditions": [
              {
                "paramName": "method",
                "paramValue": "update",
                "type": "EQUALS"
              }
            ],
            "help": "When checked, this will add a record showing that the user has visited this URL"
          },
          {
            "type": "GROUP",
            "name": "data_attributes",
            "displayName": "Data Attributes",
            "groupStyle": "ZIPPY_CLOSED",
            "subParams": [
              {
                "type": "LABEL",
                "name": "data_attributes_help",
                "displayName": "These attributes are used to update user/lead information. \nPlease see https://developers.intercom.com/installing-intercom/docs/javascript-api-attributes-objects#section-data-attributes for detailed information."
              },
              {
                "type": "TEXT",
                "name": "email",
                "displayName": "User Email",
                "simpleValueType": true,
                "help": "(Optional) Bind this to a variable that would hold the email address of the currently logged-in user (Only applicable to users). \nImportant: Do not enter a specific email address, as this address would apply to all your visitors and skew your data.",
                "valueValidators": [],
                "valueHint": "Choose a variable"
              },
              {
                "type": "TEXT",
                "name": "user_id",
                "displayName": "User ID",
                "simpleValueType": true,
                "help": "(Optional) Bind this to a variable that would hold the \"User ID\" value of the currently logged-in user (Only applicable to users). \nImportant: Do not enter a specific user ID, as this ID would apply to all your visitors and skew your data.",
                "valueValidators": [],
                "valueHint": "Choose a variable"
              },
              {
                "type": "TEXT",
                "name": "created_at",
                "displayName": "User Sign-Up Timestamp",
                "simpleValueType": true,
                "help": "(Optional) Bind this to a variable that would hold the Unix timestamp (in seconds) when the user signed up to your app (Only applicable to users)",
                "valueValidators": [
                  {
                    "type": "POSITIVE_NUMBER"
                  }
                ],
                "valueHint": "Choose a variable",
                "valueUnit": "Unix timestamp (in seconds)"
              },
              {
                "type": "TEXT",
                "name": "name",
                "displayName": "Name",
                "simpleValueType": true,
                "help": "(Optional) Bind this to a variable that would hold name of the current user/lead.\nImportant: Do not enter a specific name, as this would apply to all your visitors/users and skew your data.",
                "valueValidators": [],
                "valueHint": "Choose a variable"
              },
              {
                "type": "TEXT",
                "name": "phone",
                "displayName": "Phone Number",
                "simpleValueType": true,
                "help": "(Optional) Bind this to a variable that would hold phone number of the current user/lead.\nImportant: Do not enter a specific phone number, as this number would apply to all your visitors/users and skew your data.",
                "valueValidators": [],
                "valueHint": "Choose a variable"
              },
              {
                "type": "TEXT",
                "name": "user_hash",
                "displayName": "User Hash (Identity Verification)",
                "simpleValueType": true,
                "help": "(Optional) Bind this to a variable that would hold the \"user hash\" of the currently logged-in user (Only applicable to users).\nSee more details here: https://docs.intercom.com/configure-intercom-for-your-product-or-site/staying-secure/enable-identity-verification-on-your-web-product",
                "valueValidators": [],
                "valueHint": "Choose a variable"
              },
              {
                "type": "TEXT",
                "name": "avatar_image_url",
                "displayName": "Avatar Image URL",
                "simpleValueType": true,
                "help": "(Optional) The avatar/profile picture of the user. Note: must be HTTPS.",
                "valueValidators": [],
                "valueHint": "Choose a variable"
              },
              {
                "type": "SIMPLE_TABLE",
                "name": "company",
                "displayName": "Company Attributes",
                "simpleTableColumns": [
                  {
                    "defaultValue": "",
                    "displayName": "Attribute Name",
                    "name": "attr_key",
                    "type": "SELECT",
                    "isUnique": true,
                    "macrosInSelect": true,
                    "selectItems": [
                      {
                        "value": "company_id",
                        "displayValue": "Company ID"
                      },
                      {
                        "value": "created_at",
                        "displayValue": "Created At (Unix Timestamp)"
                      },
                      {
                        "value": "name",
                        "displayValue": "Company Name"
                      },
                      {
                        "value": "monthly_spend",
                        "displayValue": "Monthly Spend"
                      },
                      {
                        "value": "plan",
                        "displayValue": "Plan"
                      },
                      {
                        "value": "size",
                        "displayValue": "Size"
                      },
                      {
                        "value": "website",
                        "displayValue": "Website"
                      },
                      {
                        "value": "industry",
                        "displayValue": "Industry"
                      }
                    ]
                  },
                  {
                    "defaultValue": "",
                    "displayName": "Attribute Value",
                    "name": "attr_value",
                    "type": "TEXT"
                  },
                  {
                    "defaultValue": "gtm",
                    "displayName": "Installation type",
                    "name": "installation_type",
                    "type": "TEXT"
                  }
                ],
                "help": "Current user\u0027s company (Only applicable to users). Use variables as Attribute Name to specify custom company attributes.\nSee https://developers.intercom.com/installing-intercom/docs/javascript-api-attributes-objects#section-company-object for more details."
              }
            ],
            "enablingConditions": [
              {
                "paramName": "method",
                "paramValue": "install",
                "type": "EQUALS"
              },
              {
                "paramName": "method",
                "paramValue": "update",
                "type": "EQUALS"
              },
              {
                "paramName": "method",
                "paramValue": "boot",
                "type": "EQUALS"
              }
            ],
            "help": "(Optional) These attributes are used to update user/lead information. Please see https://developers.intercom.com/installing-intercom/docs/javascript-api-attributes-objects#section-data-attributes for detailed information."
          },
          {
            "type": "GROUP",
            "name": "custom_attributes_section",
            "displayName": "Custom Data Attributes",
            "groupStyle": "ZIPPY_CLOSED",
            "subParams": [
              {
                "type": "SIMPLE_TABLE",
                "name": "custom_attributes",
                "displayName": "Custom Attributes",
                "simpleTableColumns": [
                  {
                    "defaultValue": "",
                    "displayName": "Attribute Name",
                    "name": "attr_key",
                    "type": "TEXT"
                  },
                  {
                    "defaultValue": "",
                    "displayName": "Attribute Value",
                    "name": "attr_value",
                    "type": "TEXT"
                  }
                ],
                "enablingConditions": [],
                "help": ""
              }
            ],
            "enablingConditions": [
              {
                "paramName": "method",
                "paramValue": "install",
                "type": "EQUALS"
              },
              {
                "paramName": "method",
                "paramValue": "update",
                "type": "EQUALS"
              },
              {
                "paramName": "method",
                "paramValue": "boot",
                "type": "EQUALS"
              }
            ]
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "prepopulated_message",
        "displayName": "Pre-Populate Message",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "showNewMessage",
            "type": "EQUALS"
          }
        ],
        "help": "(Optional) Pre-populate the message composer (only possible with Intercom\u0027s Inbox Essential \u0026 Pro product)"
      },
      {
        "type": "TEXT",
        "name": "callback_event_name",
        "displayName": "Event Name",
        "simpleValueType": true,
        "notSetText": "Event name is required for this method",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "onHide",
            "type": "EQUALS"
          },
          {
            "paramName": "method",
            "paramValue": "onShow",
            "type": "EQUALS"
          },
          {
            "paramName": "method",
            "paramValue": "onUnreadCountChange",
            "type": "EQUALS"
          }
        ],
        "help": "Trigger a dataLayer event when we hide/show the messenger or whenever the current number of unread messages changes.",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "event_name",
        "displayName": "Event Name",
        "simpleValueType": true,
        "notSetText": "Event name is required for this method",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "trackEvent",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "event_attributes",
        "displayName": "Event Attributes",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Attribute Name",
            "name": "attr_key",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Attribute Value",
            "name": "attr_value",
            "type": "TEXT"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "trackEvent",
            "type": "EQUALS"
          }
        ],
        "help": "(Optional) You can add custom information to events in the form of event metadata."
      },
      {
        "type": "TEXT",
        "name": "tour_id",
        "displayName": "Tour ID",
        "simpleValueType": true,
        "notSetText": "You need to call this method with the id of the tour you wish to show.",
        "enablingConditions": [
          {
            "paramName": "method",
            "paramValue": "startTour",
            "type": "EQUALS"
          }
        ],
        "help": "The ID of the tour you wish to show. \nThe ID of the tour can be found in the “Use tour everywhere” section of the tour editor.",
        "valueValidators": [
          {
            "type": "POSITIVE_NUMBER"
          }
        ]
      },
     {
       "type": "TEXT",
       "name": "space_name",
       "displayName": "Space Name",
       "simpleValueType": true,
       "notSetText": "You need to call this method with the name of the space you wish to show.",
       "enablingConditions": [
         {
           "paramName": "method",
           "paramValue": "showSpace",
           "type": "EQUALS"
         }
       ],
       "help": "The name of the space you wish to show. \nThe name of the space can be 'home', 'messages', 'news' or 'help'.",
       "valueValidators": [
         {
           "type": "NON_EMPTY"
         }
       ]
     }
    ],


    "enablingConditions": [
      {
        "paramName": "method",
        "paramValue": "install",
        "type": "EQUALS"
      },
      {
        "paramName": "method",
        "paramValue": "update",
        "type": "EQUALS"
      },
      {
        "paramName": "method",
        "paramValue": "boot",
        "type": "EQUALS"
      },
      {
        "paramName": "method",
        "paramValue": "showNewMessage",
        "type": "EQUALS"
      },
      {
        "paramName": "method",
        "paramValue": "onShow",
        "type": "EQUALS"
      },
      {
        "paramName": "method",
        "paramValue": "onHide",
        "type": "EQUALS"
      },
      {
        "paramName": "method",
        "paramValue": "onUnreadCountChange",
        "type": "EQUALS"
      },
      {
        "paramName": "method",
        "paramValue": "trackEvent",
        "type": "EQUALS"
      },
      {
        "paramName": "method",
        "paramValue": "startTour",
        "type": "EQUALS"
      },
      {
        "paramName": "method",
        "paramValue": "showSpace",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Enter your template code here.
const log = require('logToConsole');
const encodeUriComponent = require('encodeUriComponent');
const copyFromWindow = require('copyFromWindow');
const callInWindow = require('callInWindow');
const setInWindow = require('setInWindow');
const injectScript = require('injectScript');
const makeInteger = require('makeInteger');
const createQueue = require('createQueue');
const dataLayerPush = createQueue('dataLayer');
const makeTableMap = require('makeTableMap');
log('data =', data);

const DATA_ATTRS = ['email', 'user_id', 'created_at', 'name', 'phone', 'unsubscribed_from_emails', 'language_override', 'avatar_image_url', 'user_hash', 'company', 'companies'];

const COMPANY_INT_FIELDS = ['created_at', 'monthly_spend', 'size'];

function getDataAttrs(data) {
  var data_attrs = DATA_ATTRS.reduce( (res, attr) => {
    if (data[attr]) {
      var attr_val = data[attr];
      if (attr == 'avatar_image_url') {
        attr_val = {
          type: 'avatar',
          image_url: data[attr]
        };
        attr = 'avatar';
      } else if (attr == 'company') {
        attr_val = makeTableMap(data[attr], 'attr_key', 'attr_value') || {};
      }
      res[attr] = attr_val;
    }
    return res;
  }, {});
  return data_attrs;
}

function setOrUpdateIntercomSettings(data) {
  var data_attrs = getDataAttrs(data);
  if (data.app_id) {
    data_attrs.app_id = data.app_id;
  }
  var settings = copyFromWindow('intercomSettings') || {};
  for (var k in data_attrs) {
    settings[k] = data_attrs[k];
  }
  if (data.custom_attributes) {
    var custom_attrs = makeTableMap(data.custom_attributes, 'attr_key', 'attr_value') || {};
    for (k in custom_attrs) {
      settings[k] = custom_attrs[k];
    }
  }
  settings.installation_type = 'gtm';
  setInWindow('intercomSettings', settings, true);
  return settings;
}

function setPlaceholderEventQueue() {
  log("setPlaceholderEventQueue");
  const queue = (params)=>{
    callInWindow('Intercom.q.push', params);
  };
  setInWindow('Intercom', function(params){
    queue(arguments);
  });
  setInWindow('Intercom.q', []);
}

function getIntercom() {
  var ic = copyFromWindow("Intercom");
  if (typeof ic !== "function") {
    setPlaceholderEventQueue();
    ic = copyFromWindow("Intercom");
  }
  return ic;
}

function onLoadSuccess() {
  var ic = copyFromWindow("Intercom");
  log("Intercom loaded:", ic);
  data.gtmOnSuccess();
}

function onLoadFailure() {
  log("Failed loading Intercom");
    data.gtmOnFailure();
}

function updateMessenger(intercomSettings) {
  log("Updating Messenger settings");
  callInWindow('Intercom', 'reattach_activator');
  callInWindow('Intercom', 'update', intercomSettings);
}

function loadMessenger() {
  var app_id = data.app_id;
  if (!app_id) {
    data.gtmOnFailure();
    return;
  }
  const url = 'https://widget.intercom.io/widget/' + encodeUriComponent(app_id);
  injectScript(url, onLoadSuccess, onLoadFailure, url);
}

function install(ic, settings) {
   loadMessenger();
}

function update(ic, settings) {
  log("Updating Messenger settings: ", settings);
  if (data.log_impression) {
    ic(data.method, settings);
  } else {
    ic(data.method);
  }
  data.gtmOnSuccess();
}

function boot(ic, settings) {
  if (!data.app_id) {
    log("Boot failed - Workspace ID missing: ", settings);
    data.gtmOnFailure();
    return;
  }
  log("Booting Messenger, settings: ", settings);
  ic(data.method, settings);
  data.gtmOnSuccess();
}

function invokeMethod(ic, settings) {
  log("Invoking method: ", data.method);
  ic(data.method);
  data.gtmOnSuccess();
}

function showNewMessage(ic, settings) {
  if (data.prepopulated_message) {
    ic(data.method, data.prepopulated_message);
  } else {
    ic(data.method);
  }
  data.gtmOnSuccess();
}

function registerCallback(ic, settings) {
  var method = data.method;
  var callbackEventName = data.callback_event_name;
  log("registering callback: ", method, callbackEventName);
  if (!method || !callbackEventName) {
    data.gtmOnFailure();
    return;
  }
  var callback = function(p) {
    log("Callback fired: ", method, callbackEventName);
    var dataToPush = {'event': callbackEventName};
    if (method === 'onUnreadCountChange') {
      dataToPush.intercom_unread_count = p;
    }
    dataLayerPush(dataToPush);
  };
  ic(method, callback);
  data.gtmOnSuccess();
}

function trackEvent(ic, settings) {
  var event_name = data.event_name;
  if (!event_name) {
    data.gtmOnFailure();
    return;
  }
  var event_attrs = {};
  if (data.event_attributes) {
    event_attrs = makeTableMap(data.event_attributes, 'attr_key', 'attr_value');
  }
  ic(data.method, event_name, event_attrs);
  data.gtmOnSuccess();
}

function startTour(ic, settings) {
  if (!data.tour_id) {
    data.gtmOnFailure();
    return;
  }
  var tour_id = makeInteger(data.tour_id);
  log('startTour: ', tour_id);
  ic(data.method, tour_id);
  data.gtmOnSuccess();
}

function showSpace(ic, settings) {
  var space_name = data.space_name;
  if (!space_name) {
    data.gtmOnFailure();
    return;
  }
  log('showSpace: ', space_name);
  ic(data.method, space_name);
  data.gtmOnSuccess();
}

var methodMap = {
  install: install,
  update: update,
  boot: boot,
  shutdown: invokeMethod,
  hide: invokeMethod,
  show: invokeMethod,
  showMessages: invokeMethod,
  showNewMessage: showNewMessage,
  onShow: registerCallback,
  onHide: registerCallback,
  onUnreadCountChange: registerCallback,
  trackEvent: trackEvent,
  startTour: startTour,
  showSpace: showSpace,
};

function main() {
  let settings = setOrUpdateIntercomSettings(data);
  var ic = getIntercom();
  let methodFunc = methodMap[data.method];
  if (!methodFunc) {
    data.gtmOnFailure();
    return;
  }
  methodFunc(ic, settings);
}

main();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "Intercom"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "intercomSettings"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "Intercom.q"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "Intercom.q.push"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://widget.intercom.io/widget/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: install_works_with_workspace_id_only
  code: |-
    const mockData = {
      method: 'install',
      app_id: TEST_APP_ID,
    };

    // Mock 'injectScript'
    mock('injectScript', function(url, onSuccess, onFailure, cacheToken) {
        onSuccess();
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: install_works_with_partial_arguments
  code: |-
    const mockData = {
      method: 'install',
      app_id: TEST_APP_ID,
      email: 'cookie.monster@sesame.com',
      name: 'Cookie Monster'
    };

    // Mock 'injectScript'
    mock('injectScript', function(url, onSuccess, onFailure, cacheToken) {
        onSuccess();
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: install_works_with_extra_arguments
  code: |-
    const mockData = {
      method: 'install',
      app_id: TEST_APP_ID,
      log_impression: true,
      prepopulated_message: 'cookie!'
    };

    // Mock 'injectScript'
    mock('injectScript', function(url, onSuccess, onFailure, cacheToken) {
        onSuccess();
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: install_works_when_called_more_than_once
  code: |-
    const mockData = {
      method: 'install',
      app_id: TEST_APP_ID,
    };

    // Mock 'injectScript'
    mock('injectScript', function(url, onSuccess, onFailure, cacheToken) {
        onSuccess();
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();

    // Do it again!
    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: install_fails_when_script_load_fails
  code: |-
    const mockData = {
      method: 'install',
      app_id: TEST_APP_ID,
    };

    // Mock 'injectScript'
    mock('injectScript', function(url, onSuccess, onFailure, cacheToken) {
        onFailure();
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnFailure').wasCalled();
- name: boot_works_with_workspace_id_only
  code: |-
    const copyFromWindow = require('copyFromWindow');
    const mockData = {
      method: 'boot',
      app_id: TEST_APP_ID
    };

    var q = copyFromWindow('Intercom.q') || [];
    var q_len = q.length;

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify window.Intercom.q has one item ['boot',[args]]
    q = copyFromWindow('Intercom.q');
    assertThat(q).hasLength(q_len+1);
    var q_item = q[q_len];
    assertThat(q_item).isArray();
    assertThat(q_item[0]).isEqualTo('boot');

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: boot_works_with_extra attributes
  code: |-
    const copyFromWindow = require('copyFromWindow');
    const mockData = {
      method: 'boot',
      app_id: TEST_APP_ID,
      log_impression: true,
      prepopulated_message: 'cookie!',
      email: 'cookie.monster@sesame.com',
      name: 'Cookie Monster'
    };

    var q = copyFromWindow('Intercom.q') || [];
    var q_len = q.length;

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify window.Intercom.q has one item ['boot',[args]]
    q = copyFromWindow('Intercom.q');
    assertThat(q).hasLength(q_len+1);
    var q_item = q[q_len];
    assertThat(q_item).isArray();
    assertThat(q_item[0]).isEqualTo('boot');

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: update_passes_settings_when_log_impression_checked
  code: |-
    const copyFromWindow = require('copyFromWindow');

    const mockData = {
      method: 'update',
      log_impression: true,
    };

    var q = copyFromWindow('Intercom.q') || [];
    var q_len = q.length;

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify window.Intercom.q has one item ['boot',[args]]
    q = copyFromWindow('Intercom.q');
    assertThat(q).hasLength(q_len+1);
    var q_item = q[q_len];
    assertThat(q_item).isArray();
    assertThat(q_item[0]).isEqualTo('update');
    assertThat(q_item[1]).isObject();

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: update_works_with_partial_arguments
  code: |-
    const copyFromWindow = require('copyFromWindow');

    const mockData = {
      method: 'update',
      app_id: TEST_APP_ID,
      log_impression: true,
      prepopulated_message: 'cookie!',
      email: TEST_EMAIL,
      name: TEST_NAME
    };

    var q = copyFromWindow('Intercom.q') || [];
    var q_len = q.length;

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify window.Intercom.q has one item ['boot',[args]]
    q = copyFromWindow('Intercom.q');
    assertThat(q).hasLength(q_len+1);
    var q_item = q[q_len];
    assertThat(q_item).isArray();
    assertThat(q_item[0]).isEqualTo('update');

    // Verify window.intercomSettings were updated correctly
    var settings = copyFromWindow('intercomSettings');
    assertThat(settings).isObject();
    assertThat(settings.email).isEqualTo(TEST_EMAIL);
    assertThat(settings.name).isEqualTo(TEST_NAME);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: hide_ignores_arguments
  code: |-
    const copyFromWindow = require('copyFromWindow');
    const mockData = {
      method: 'hide',
      app_id: TEST_APP_ID,
      log_impression: true,
      prepopulated_message: 'cookie!',
      email: TEST_EMAIL,
      name: TEST_NAME
    };

    var q = copyFromWindow('Intercom.q') || [];
    var q_len = q.length;

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify window.Intercom.q's last item is ['hide']
    q = copyFromWindow('Intercom.q');
    assertThat(q).hasLength(q_len+1);
    var q_item = q[q_len];
    assertIsEventWithNameAndNoArguments(q_item, 'hide');

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: installation_type_is_set
  code: |-
    const copyFromWindow = require('copyFromWindow');
    const mockData = {
      method: 'boot',
      app_id: TEST_APP_ID
    };

    var q = copyFromWindow('Intercom.q') || [];
    var q_len = q.length;

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify window.Intercom.q has one item ['boot',[args]]
    q = copyFromWindow('Intercom.q');
    assertThat(q).hasLength(q_len+1);
    var q_item = q[q_len];
    assertThat(q_item).isArray();
    assertThat(q_item[0]).isEqualTo('boot');

    // Verify window.intercomSettings were updated correctly
    var settings = copyFromWindow('intercomSettings');
    assertThat(settings).isObject();
    assertThat(settings.installation_type).isEqualTo('gtm');

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();

- name: showNewMessage_works_with_prepopulated_message
  code: |-
    const copyFromWindow = require('copyFromWindow');
    const TESTED_METHOD = 'showNewMessage';
    const mockData = {
      method: TESTED_METHOD,
      prepopulated_message: 'Cookie!',
    };

    var q = copyFromWindow('Intercom.q') || [];
    var q_len = q.length;

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify window.Intercom.q's last item is ['hide']
    q = copyFromWindow('Intercom.q');
    assertThat(q).hasLength(q_len+1);
    var q_item = q[q_len];
    assertIsEventWithNameAndStringArgument(q_item, TESTED_METHOD, mockData.prepopulated_message);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: trackEvent_fails_with_event_attributes_only
  code: |-
    const copyFromWindow = require('copyFromWindow');
    const mockData = {
      method: 'trackEvent',
      event_attributes: [{attr_key: 'SKU', attr_value: 'a1b2c3'}]
    };

    var q = copyFromWindow('Intercom.q') || [];
    var q_len = q.length;

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify window.Intercom.q remains the same size
    q = copyFromWindow('Intercom.q');
    assertThat(q).hasLength(q_len);

    // Verify that the tag finished with failure.
    assertApi('gtmOnFailure').wasCalled();
- name: trackEvent_works_with_event_name
  code: |-
    const copyFromWindow = require('copyFromWindow');
    const TESTED_METHOD = 'trackEvent';
    const mockData = {
      method: TESTED_METHOD,
      event_name: 'some_event',
    };

    var q = copyFromWindow('Intercom.q') || [];
    var q_len = q.length;

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify window.Intercom.q's last item is ['hide']
    q = copyFromWindow('Intercom.q');
    assertThat(q).hasLength(q_len+1);
    var q_item = q[q_len];
    assertIsEventWithNameAndStringAndObjectArguments(q_item, TESTED_METHOD, mockData.event_name, {});

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: trackEvent_works_with_event_name_and_attributes
  code: |-
    const copyFromWindow = require('copyFromWindow');
    const TESTED_METHOD = 'trackEvent';
    const mockData = {
      method: TESTED_METHOD,
      event_name: 'some_event',
      event_attributes: [{attr_key: 'SKU', attr_value: 'a1b2c3'}]
    };

    var q = copyFromWindow('Intercom.q') || [];
    var q_len = q.length;

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify window.Intercom.q's last item is ['hide']
    q = copyFromWindow('Intercom.q');
    assertThat(q).hasLength(q_len+1);
    var q_item = q[q_len];
    assertIsEventWithNameAndStringAndObjectArguments(q_item, TESTED_METHOD, mockData.event_name, {SKU: 'a1b2c3'});

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: trackEvent_filters_out_ilegal_attributes
  code: |-
    const copyFromWindow = require('copyFromWindow');
    const TESTED_METHOD = 'trackEvent';
    const mockData = {
      method: TESTED_METHOD,
      event_name: 'some_event',
      event_attributes: [{attr_key: 'SKU', attr_value: 'a1b2c3'}, {key: 'name', value: 'jehovah'}]
    };

    var q = copyFromWindow('Intercom.q') || [];
    var q_len = q.length;

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify window.Intercom.q's last item is ['hide']
    q = copyFromWindow('Intercom.q');
    assertThat(q).hasLength(q_len+1);
    var q_item = q[q_len];
    assertIsEventWithNameAndStringAndObjectArguments(q_item, TESTED_METHOD, mockData.event_name, {SKU: 'a1b2c3'});

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: methods_fail_with_no_arguments
  code: "const copyFromWindow = require('copyFromWindow');\nconst METHODS_TO_TEST\
    \ = ['install', 'boot', 'onHide', 'onShow', 'onUnreadCountChange', 'trackEvent',\
    \ 'startTour'];\n\nfor (var i=0; i < METHODS_TO_TEST.length; i++) {\n  var q =\
    \ copyFromWindow('Intercom.q') || [];\n  var q_len = q.length;\n  \n  // Call\
    \ runCode to run the template's code.\n  runCode({method: METHODS_TO_TEST[i]});\n\
    \n  // Verify window.Intercom.q remains the same size\n  q = copyFromWindow('Intercom.q');\n\
    \  assertThat(q).hasLength(q_len);\n\n  // Verify that the tag finished with failure.\n\
    \  assertApi('gtmOnFailure').wasCalled();  \n}\n\n\n\n"
- name: methods_works_with_no_arguments
  code: "const copyFromWindow = require('copyFromWindow');\nconst METHODS_TO_TEST\
    \ = ['shutdown', 'update', 'hide', 'show', 'showMessages', 'showNewMessage'];\n\
    \nfor (var i=0; i < METHODS_TO_TEST.length; i++) {\n  var q = copyFromWindow('Intercom.q')\
    \ || [];\n  var q_len = q.length;\n  \n  // Call runCode to run the template's\
    \ code.\n  runCode({method: METHODS_TO_TEST[i]});\n\n  // Verify window.Intercom.q\
    \ remains the same size\n  q = copyFromWindow('Intercom.q');\n  assertThat(q).hasLength(q_len+1);\n\
    \  var q_item = q[q_len];\n  assertIsEventWithNameAndNoArguments(q_item, METHODS_TO_TEST[i]);\n\
    \n  // Verify that the tag finished successfully.\n  assertApi('gtmOnSuccess').wasCalled();\n\
    }\n\n\n\n"
- name: set_callbacks_work_with_event_name
  code: |-
    const copyFromWindow = require('copyFromWindow');
    const METHODS_TO_TEST = ['onHide', 'onShow', 'onUnreadCountChange'];

    for (var i=0; i < METHODS_TO_TEST.length; i++) {
      const mockData = {
        method: METHODS_TO_TEST[i],
        callback_event_name: 'intercom_on_something_happened',
      };

      var q = copyFromWindow('Intercom.q') || [];
      var q_len = q.length;

      // Call runCode to run the template's code.
      runCode(mockData);

      // Verify window.Intercom.q's last item is ['hide']
      q = copyFromWindow('Intercom.q');
      assertThat(q).hasLength(q_len+1);
      var q_item = q[q_len];
      assertIsEventWithNameAndFunctionArgument(q_item, METHODS_TO_TEST[i]);

      // Verify that the tag finished successfully.
      assertApi('gtmOnSuccess').wasCalled();
    }
setup: |-
  const TEST_APP_ID = 'g0yyb1fs';
  const TEST_EMAIL = 'cookie.monster@sesame.com';
  const TEST_NAME = 'Cookie Monster';

  function assertIsEventWithNameAndNoArguments(item, event_name) {
    assertThat(item).isArray();
    assertThat(item).hasLength(1);
    assertThat(item[0]).isEqualTo(event_name);
  }

  function assertIsEventWithNameAndStringArgument(item, event_name, string_arg) {
    assertThat(item).isArray();
    assertThat(item).hasLength(2);
    assertThat(item[0]).isEqualTo(event_name);
    assertThat(item[1]).isString();
    assertThat(item[1]).isEqualTo(string_arg);
  }

  function assertIsEventWithNameAndFunctionArgument(item, event_name) {
    assertThat(item).isArray();
    assertThat(item).hasLength(2);
    assertThat(item[0]).isEqualTo(event_name);
    assertThat(item[1]).isFunction();
  }

  function assertIsEventWithNameAndStringAndObjectArguments(item, event_name, string_arg, obj_arg) {
    assertThat(item).isArray();
    assertThat(item).hasLength(3);
    assertThat(item[0]).isEqualTo(event_name);
    assertThat(item[1]).isString();
    assertThat(item[1]).isEqualTo(string_arg);
    assertThat(item[2]).isObject();
    assertThat(item[2]).isEqualTo(obj_arg);
  }

  function assertIsEventWithNameAndIntegerArgument(item, event_name, int_arg) {
    assertThat(item).isArray();
    assertThat(item).hasLength(2);
    assertThat(item[0]).isEqualTo(event_name);
    assertThat(item[1]).isNumber();
    assertThat(item[1]).isEqualTo(int_arg);
  }


___NOTES___